<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Pirâmides Regulares — Modelos 3D Interativos</title>

  <style>
    html,body{
      height:100%;
      margin:0;
      font-family:Arial,Helvetica,sans-serif;
      background:#f4f6f8;
    }
    #app{
      display:flex;
      flex-direction:column;
      height:100vh;
    }
    header{
      padding:12px 16px;
      background:#0b5;
      color:#003;
      display:flex;
      align-items:center;
      gap:12px;
    }
    header h1{
      font-size:16px;
      margin:0;
    }
    main{
      flex:1;
      display:flex;
      gap:12px;
      padding:12px;
    }
    #viewer{
      flex:1;
      border-radius:12px;
      background:#111;
      overflow:hidden;
      display:flex;
      align-items:center;
      justify-content:center;
      min-height:350px;
    }
    #controls{
      width:320px;
      max-width:40%;
      background:#fff;
      border-radius:12px;
      padding:12px;
      box-shadow:0 6px 18px rgba(0,0,0,.08);
      overflow:auto;
    }
    label{
      display:block;
      font-size:13px;
      margin-top:10px;
    }
    input[type=range]{width:100%}
    input[type=number],select{
      width:100%;
      padding:6px;
      margin-top:6px;
      border-radius:6px;
      border:1px solid #ddd;
    }
    button{
      margin-top:10px;
      padding:8px 10px;
      border-radius:8px;
      border:0;
      background:#0b5;
      color:#fff;
      cursor:pointer;
    }
    footer{
      padding:8px 12px;
      font-size:12px;
      color:#666;
    }
    .metric{
      background:#eef;
      padding:8px;
      border-radius:8px;
      margin-top:8px;
    }
    @media (max-width:900px){
      main{flex-direction:column}
      #controls{width:100%;max-width:100%}
    }
    .watermark {
      position: fixed;
      bottom: 10px;
      right: 10px;
      font-size: 10px;
      color: rgba(255,255,255,0.35);
      pointer-events: none;
      user-select: none;
      z-index: 9999;
    }
  </style>
</head>

<body>
  <div id="app">
    <header>
      <h1>Pirâmides Regulares — Modelos 3D Interativos (mobile-ready)</h1>
      <div style="font-size:12px;color:#003;opacity:0.9">Toque e arraste para rotacionar; pinça para zoom</div>
    </header>

    <main>
      <div id="viewer"></div>

      <aside id="controls">
        <label>Tipo de base (n lados)
          <select id="sides">
            <option value="3">Triangular (3)</option>
            <option value="4" selected>Quadrada (4)</option>
            <option value="5">Pentagonal (5)</option>
            <option value="6">Hexagonal (6)</option>
          </select>
        </label>

        <label>Comprimento do lado da base (cm)
          <input id="sideLen" type="number" min="0.5" step="0.1" value="4">
        </label>

        <label>Altura da pirâmide (cm)
          <input id="height" type="number" min="0.5" step="0.1" value="6">
        </label>

        <label>Apótema lateral (a1) — opcional (se vazio, é calculado)
          <input id="apotemaLat" type="number" step="0.1" placeholder="Deixe em branco para calcular">
        </label>

        <label>Cor do material
          <select id="color">
            <option value="#e07a5f">Terracota</option>
            <option value="#3d5a80" selected>Azul escuro</option>
            <option value="#98c1d9">Azul claro</option>
            <option value="#2a9d8f">Verde</option>
            <option value="#f4d35e">Amarelo</option>
          </select>
        </label>

        <button id="build">Gerar Pirâmide</button>
        <button id="download">Exportar GLB</button>

        <div class="metric" id="metrics">
          <strong>Métricas (automático)</strong>
          <div id="mPerimeter">Perímetro: —</div>
          <div id="mAreaBase">Área da base: —</div>
          <div id="mAreaLat">Área lateral: —</div>
          <div id="mAreaTotal">Área total: —</div>
          <div id="mVolume">Volume: —</div>
        </div>

        <div style="font-size:12px;color:#444;margin-top:12px">
          Em celulares: use dois dedos para zoom e arraste para rotacionar.  
          O botão "Exportar GLB" baixa o modelo 3D.
        </div>
      </aside>
    </main>

    <footer>Gerado automaticamente — Modelo Educacional de Pirâmide Regular</footer>
  </div>

  <div class="watermark">Danilo Neves • Thiago Alexandre • Roberta Kelly • Odilardo • Sofia Souza</div>

  <!-- CDN scripts -->
  <script src="https://unpkg.com/three@0.152.2/build/three.min.js"></script>
  <script src="https://unpkg.com/three@0.152.2/examples/js/controls/OrbitControls.js"></script>
  <script src="https://unpkg.com/three@0.152.2/examples/js/exporters/GLTFExporter.js"></script>

  <script>
    const container = document.getElementById('viewer');
    const scene = new THREE.Scene();
    scene.background = new THREE.Color(0x111111);

    const camera = new THREE.PerspectiveCamera(45, container.clientWidth/container.clientHeight, 0.1, 1000);
    camera.position.set(8, 8, 10);

    const renderer = new THREE.WebGLRenderer({antialias:true});
    renderer.setPixelRatio(window.devicePixelRatio || 1);
    renderer.setSize(container.clientWidth, container.clientHeight);
    container.appendChild(renderer.domElement);

    const controls = new THREE.OrbitControls(camera, renderer.domElement);
    controls.enableDamping = true;
    controls.dampingFactor = 0.12;

    const hemi = new THREE.HemisphereLight(0xffffff, 0x444444, 0.9);
    scene.add(hemi);

    const dir = new THREE.DirectionalLight(0xffffff, 0.8);
    dir.position.set(5,10,7);
    scene.add(dir);

    const grid = new THREE.GridHelper(40, 40, 0x222222, 0x222222);
    grid.material.opacity = 0.12;
    grid.material.transparent = true;
    scene.add(grid);

    let pyramidMesh = null;

    function clearPyramid() {
      if (pyramidMesh) {
        scene.remove(pyramidMesh);
        pyramidMesh.geometry.dispose();
        pyramidMesh.material.dispose();
        pyramidMesh = null;
      }
    }

    function createRegularPyramid(n, sideLen, height) {
      const angle = (2 * Math.PI) / n;
      const R = sideLen / (2 * Math.sin(Math.PI / n));

      const baseVerts = [];
      for (let i = 0; i < n; i++) {
        const a = i * angle + Math.PI / 2;
        const x = R * Math.cos(a);
        const z = R * Math.sin(a);
        baseVerts.push(new THREE.Vector3(x, 0, z));
      }

      const apex = new THREE.Vector3(0, height, 0);
      const positions = [];

      for (let i = 0; i < n; i++) {
        const a = baseVerts[i];
        const b = baseVerts[(i + 1) % n];
        positions.push(a.x, a.y, a.z);
        positions.push(b.x, b.y, b.z);
        positions.push(apex.x, apex.y, apex.z);
      }

      for (let i = 1; i < n - 1; i++) {
        const a = baseVerts[0];
        const b = baseVerts[i];
        const c = baseVerts[i + 1];
        positions.push(a.x, a.y, a.z);
        positions.push(c.x, c.y, c.z);
        positions.push(b.x, b.y, b.z);
      }

      const geom = new THREE.BufferGeometry();
      geom.setAttribute('position', new THREE.BufferAttribute(new Float32Array(positions), 3));
      geom.computeVertexNormals();
      return geom;
    }

    function buildPyramid() {
      const n = parseInt(document.getElementById('sides').value);
      const sideLen = parseFloat(document.getElementById('sideLen').value) || 2;
      const height = parseFloat(document.getElementById('height').value) || 3;
      const color = document.getElementById('color').value;

      clearPyramid();

      const geom = createRegularPyramid(n, sideLen,
      
